stages:
    - build

.fc: &fedora
    stage: build
    only:
    - master
    - devel
    script:
    - dnf -y install gcc-c++ qt5-qtbase-devel rpm-build make
    - tar czf qmtn.tar.gz * --transform="s%^%qmtn-ci/%"
    - mkdir -p buildroot/SOURCES
    - mv qmtn.tar.gz buildroot/SOURCES/
    - rpmbuild -bb --define "_topdir $(pwd)/buildroot" buildrpm/qmtn.spec
    - mv buildroot/RPMS/x86_64/*.rpm .

fc27:
    image: fedora:27
    <<: *fedora
#    when: manual
    artifacts:
        name: qmtn-fc27
        expire_in: 30 week
        paths:
        - ./*.rpm

fc28:
    image: fedora:28
    <<: *fedora
    artifacts:
        name: qmtn-fc28
        expire_in: 30 week
        paths:
        - ./*.rpm


fc29:
    image: fedora:29
    <<: *fedora
    artifacts:
        name: qmtn-fc29
        expire_in: 30 week
        paths:
        - ./*.rpm
